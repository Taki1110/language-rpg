<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªæºã®æ—…äºº - Language RPG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #eee;
            padding: 20px;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #e94560, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 30px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-item .label {
            font-size: 0.8em;
            color: #888;
        }
        
        .status-item .value {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .hp { color: #e94560; }
        .level { color: #feca57; }
        .gold { color: #ffd700; }
        .english { color: #74b9ff; }
        .chinese { color: #ff6b6b; }
        
        .game-screen {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            min-height: 300px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .message {
            margin-bottom: 15px;
            line-height: 1.8;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .word-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .word-card .jp { font-size: 1.5em; margin-bottom: 10px; }
        .word-card .en { color: #74b9ff; font-size: 1.3em; margin-bottom: 5px; }
        .word-card .cn { color: #ff6b6b; font-size: 1.3em; }
        
        .battle-enemy {
            background: linear-gradient(135deg, #e94560 0%, #c0392b 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .battle-enemy h3 { margin-bottom: 10px; }
        
        .question-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .question-box h4 {
            color: #feca57;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1em;
        }
        
        input[type="text"]::placeholder {
            color: #888;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #e94560, #c0392b);
            color: #fff;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }
        
        .command-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .command-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .command-btn:hover {
            background: rgba(233, 69, 96, 0.3);
            border-color: #e94560;
        }
        
        .command-btn .icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .start-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .start-screen h2 {
            margin-bottom: 30px;
            color: #feca57;
        }
        
        .damage {
            color: #e94560;
            font-weight: bold;
        }
        
        .heal {
            color: #55efc4;
            font-weight: bold;
        }
        
        .exp {
            color: #feca57;
            font-weight: bold;
        }
        
        .gold-text {
            color: #ffd700;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ® èªæºã®æ—…äºº</h1>
        <p class="subtitle">Language RPG - è‹±èªã¨ä¸­å›½èªã‚’åŒæ™‚ã«å­¦ã¶å†’é™º</p>
        
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
        <div class="status-bar" id="statusBar" style="display: none;">
            <div class="status-item">
                <div class="label">â¤ï¸ HP</div>
                <div class="value hp" id="hp">100/100</div>
            </div>
            <div class="status-item">
                <div class="label">â­ Level</div>
                <div class="value level" id="level">1</div>
            </div>
            <div class="status-item">
                <div class="label">ğŸ’° Gold</div>
                <div class="value gold" id="gold">50</div>
            </div>
            <div class="status-item">
                <div class="label">ğŸ‡¬ğŸ‡§ English</div>
                <div class="value english" id="englishExp">0</div>
            </div>
            <div class="status-item">
                <div class="label">ğŸ‡¨ğŸ‡³ Chinese</div>
                <div class="value chinese" id="chineseExp">0</div>
            </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-screen" id="gameScreen">
            <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
            <div class="start-screen" id="startScreen">
                <h2>ã‚ãªãŸã®åå‰ã¯ï¼Ÿ</h2>
                <div class="input-group">
                    <input type="text" id="playerName" placeholder="åå‰ã‚’å…¥åŠ›" maxlength="10">
                    <button onclick="startGame()">å†’é™ºã‚’å§‹ã‚ã‚‹</button>
                </div>
            </div>
            
            <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
            <div id="mainScreen" class="hidden">
                <div id="messageArea"></div>
            </div>
        </div>
        
        <!-- ã‚³ãƒãƒ³ãƒ‰ãƒœã‚¿ãƒ³ -->
        <div class="command-buttons" id="commandButtons" style="display: none;">
            <div class="command-btn" onclick="explore()">
                <div class="icon">ğŸ”</div>
                <div>æ¢ç´¢</div>
            </div>
            <div class="command-btn" onclick="study()">
                <div class="icon">ğŸ“š</div>
                <div>å‹‰å¼·</div>
            </div>
            <div class="command-btn" onclick="battle()">
                <div class="icon">âš”ï¸</div>
                <div>æˆ¦é—˜</div>
            </div>
            <div class="command-btn" onclick="move()">
                <div class="icon">ğŸš¶</div>
                <div>ç§»å‹•</div>
            </div>
            <div class="command-btn" onclick="showStatus()">
                <div class="icon">ğŸ“Š</div>
                <div>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
            </div>
            <div class="command-btn" onclick="showVocab()">
                <div class="icon">ğŸ“–</div>
                <div>å˜èªå¸³</div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        const gameData = {
            locations: {
                "å§‹ã¾ã‚Šã®æ‘": {
                    name_en: "Starting Village",
                    name_cn: "èµ·å§‹æ‘åº„",
                    description: "è‹±èªã¨ä¸­å›½èªãŒäº¤ã˜ã‚Šåˆã†ä¸æ€è­°ãªæ‘",
                    npcs: ["æ‘ã®é•·è€", "è¨€èªã®å•†äºº"],
                    enemies: ["è¿·å­ã®ã‚¹ãƒ©ã‚¤ãƒ "],
                    connected: ["è‹±èªã®æ£®", "æ¼¢å­—ã®å±±"]
                },
                "è‹±èªã®æ£®": {
                    name_en: "English Forest",
                    name_cn: "è‹±è¯­æ£®æ—",
                    description: "è‹±èªã®é­”åŠ›ãŒæº€ã¡ãŸæ£®ã€‚æœ¨ã€…ãŒè‹±å˜èªã‚’ã•ã•ã‚„ã",
                    npcs: ["è‹±èªã®å¦–ç²¾"],
                    enemies: ["æ–‡æ³•ã‚´ãƒ–ãƒªãƒ³", "å˜èªã®ç‹¼"],
                    connected: ["å§‹ã¾ã‚Šã®æ‘", "æ–‡æ³•ã®æ´çªŸ"]
                },
                "æ¼¢å­—ã®å±±": {
                    name_cn: "æ±‰å­—å±±",
                    name_en: "Kanji Mountain",
                    description: "å¤ä»£ã®æ¼¢å­—ãŒçœ ã‚‹å±±ã€‚é¢¨ã«æ¼¢å­—ã®éŸ³ãŒéŸ¿ã",
                    npcs: ["æ›¸é“ã®ä»™äºº"],
                    enemies: ["é›£èª­ãƒ‰ãƒ©ã‚´ãƒ³", "å››å­—ç†Ÿèªã‚´ãƒ¼ãƒ¬ãƒ "],
                    connected: ["å§‹ã¾ã‚Šã®æ‘", "ç™ºéŸ³ã®è°·"]
                }
            },
            vocabulary: {
                easy: [
                    {jp: "æ°´", en: "water", cn: "æ°´ (shuÇ)", theme: "nature"},
                    {jp: "ç«", en: "fire", cn: "ç« (huÇ’)", theme: "nature"},
                    {jp: "æœ¨", en: "tree", cn: "æœ¨ (mÃ¹)", theme: "nature"},
                    {jp: "å±±", en: "mountain", cn: "å±± (shÄn)", theme: "nature"},
                    {jp: "å·", en: "river", cn: "æ²³ (hÃ©)", theme: "nature"},
                    {jp: "çŒ«", en: "cat", cn: "çŒ« (mÄo)", theme: "animal"},
                    {jp: "çŠ¬", en: "dog", cn: "ç‹— (gÇ’u)", theme: "animal"},
                    {jp: "é³¥", en: "bird", cn: "é¸Ÿ (niÇo)", theme: "animal"},
                    {jp: "é£Ÿã¹ã‚‹", en: "eat", cn: "åƒ (chÄ«)", theme: "action"},
                    {jp: "é£²ã‚€", en: "drink", cn: "å– (hÄ“)", theme: "action"},
                    {jp: "è¡Œã", en: "go", cn: "å» (qÃ¹)", theme: "action"},
                    {jp: "æ¥ã‚‹", en: "come", cn: "æ¥ (lÃ¡i)", theme: "action"},
                    {jp: "å¤§ãã„", en: "big", cn: "å¤§ (dÃ )", theme: "adjective"},
                    {jp: "å°ã•ã„", en: "small", cn: "å° (xiÇo)", theme: "adjective"},
                    {jp: "æ–°ã—ã„", en: "new", cn: "æ–° (xÄ«n)", theme: "adjective"},
                    {jp: "å¤ã„", en: "old", cn: "æ—§ (jiÃ¹)", theme: "adjective"}
                ],
                medium: [
                    {jp: "å›³æ›¸é¤¨", en: "library", cn: "å›¾ä¹¦é¦† (tÃºshÅ«guÇn)", theme: "place"},
                    {jp: "ç—…é™¢", en: "hospital", cn: "åŒ»é™¢ (yÄ«yuÃ n)", theme: "place"},
                    {jp: "éƒµä¾¿å±€", en: "post office", cn: "é‚®å±€ (yÃ³ujÃº)", theme: "place"},
                    {jp: "ç¾è¡“é¤¨", en: "art museum", cn: "ç¾æœ¯é¦† (mÄ›ishÃ¹guÇn)", theme: "place"},
                    {jp: "å†’é™º", en: "adventure", cn: "å†’é™© (mÃ oxiÇn)", theme: "concept"},
                    {jp: "å‹æƒ…", en: "friendship", cn: "å‹è°Š (yÇ’uyÃ¬)", theme: "concept"},
                    {jp: "æŒ‘æˆ¦", en: "challenge", cn: "æŒ‘æˆ˜ (tiÇozhÃ n)", theme: "concept"}
                ]
            },
            battles: {
                "æ–‡æ³•ã‚´ãƒ–ãƒªãƒ³": {
                    hp: 30,
                    questions: [
                        {q: "ã€Œç§ã¯å­¦ç”Ÿã§ã™ã€ã®è‹±èªã¯ï¼Ÿ", a: ["i am a student", "i'm a student"], type: "english", hint: "I am..."},
                        {q: "ã€ŒçŒ«ã€ã®ä¸­å›½èªã¯ï¼Ÿ", a: ["çŒ«", "mÄo"], type: "chinese", hint: "å‹•ç‰©ã®åå‰"}
                    ]
                },
                "å˜èªã®ç‹¼": {
                    hp: 40,
                    questions: [
                        {q: "ã€Œæ°´ã€ã®è‹±èªã¯ï¼Ÿ", a: ["water"], type: "english", hint: "Wã‹ã‚‰å§‹ã¾ã‚‹"},
                        {q: "Fire ã®ä¸­å›½èªã¯ï¼Ÿ", a: ["ç«", "huÇ’"], type: "chinese", hint: "4ç”»ã®æ¼¢å­—"}
                    ]
                },
                "è¿·å­ã®ã‚¹ãƒ©ã‚¤ãƒ ": {
                    hp: 20,
                    questions: [
                        {q: "ã€Œå¤§ãã„ã€ã®è‹±èªã¯ï¼Ÿ", a: ["big", "large"], type: "english", hint: "Bã‹ã‚‰å§‹ã¾ã‚‹"},
                        {q: "ã€Œå±±ã€ã®ä¸­å›½èªã¯ï¼Ÿ", a: ["å±±", "shÄn"], type: "chinese", hint: "3ç”»ã®æ¼¢å­—"}
                    ]
                }
            }
        };

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿
        let player = {
            name: "",
            level: 1,
            exp: 0,
            hp: 100,
            maxHp: 100,
            gold: 50,
            englishExp: 0,
            chineseExp: 0,
            inventory: [],
            currentLocation: "å§‹ã¾ã‚Šã®æ‘",
            inBattle: false,
            currentEnemy: null
        };

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            const nameInput = document.getElementById('playerName');
            if (!nameInput.value.trim()) {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼');
                return;
            }
            
            player.name = nameInput.value.trim();
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            document.getElementById('statusBar').style.display = 'flex';
            document.getElementById('commandButtons').style.display = 'grid';
            
            updateStatus();
            showMessage(`ã‚ˆã†ã“ãã€${player.name}ï¼<br>ã‚ãªãŸã¯ã€Œèªæºã®æ—…äººã€ã¨ã—ã¦ã€è‹±èªã¨ä¸­å›½èªãŒäº¤ã˜ã‚Šåˆã†ä¸æ€è­°ãªä¸–ç•Œã‚’å†’é™ºã—ã¾ã™ã€‚<br><br>ğŸ“ ç¾åœ¨ã®å ´æ‰€: <strong>${player.currentLocation}</strong><br><br>ã‚³ãƒãƒ³ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„ï¼`);
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text) {
            const area = document.getElementById('messageArea');
            const msg = document.createElement('div');
            msg.className = 'message';
            msg.innerHTML = text;
            area.appendChild(msg);
            area.scrollTop = area.scrollHeight;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus() {
            document.getElementById('hp').textContent = `${player.hp}/${player.maxHp}`;
            document.getElementById('level').textContent = player.level;
            document.getElementById('gold').textContent = player.gold;
            document.getElementById('englishExp').textContent = player.englishExp;
            document.getElementById('chineseExp').textContent = player.chineseExp;
        }

        // æ¢ç´¢
        function explore() {
            if (player.inBattle) return;
            
            const events = [
                "å¤ã„è¨€èªã®çŸ³ç¢‘ã‚’è¦‹ã¤ã‘ãŸï¼",
                "å¥‡å¦™ãªéŸ³ãŒèã“ãˆã‚‹...",
                "å…‰ã‚‹å˜èªãŒæµ®ã‹ã‚“ã§ã„ã‚‹ï¼",
                "èª°ã‹ã®è½ã¨ã—ç‰©ã‚’è¦‹ã¤ã‘ãŸ",
                "ä¸æ€è­°ãªæ´çªŸã‚’ç™ºè¦‹ã—ãŸï¼"
            ];
            
            const items = [
                {name: "è‹±èªã®è¾æ›¸", effect: () => { player.englishExp += 10; return "ğŸ‡¬ğŸ‡§ è‹±èªçµŒé¨“å€¤ +10"; }},
                {name: "ä¸­å›½èªã®å­—å…¸", effect: () => { player.chineseExp += 10; return "ğŸ‡¨ğŸ‡³ ä¸­å›½èªçµŒé¨“å€¤ +10"; }},
                {name: "å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³", effect: () => { 
                    const heal = Math.min(20, player.maxHp - player.hp);
                    player.hp += heal;
                    return `<span class="heal">â¤ï¸ HP +${heal}</span>`;
                }},
                {name: "è¨€èªã®çŸ³", effect: () => { player.exp += 5; return "â­ çµŒé¨“å€¤ +5"; }},
                {name: "é‡‘è²¨", effect: () => { player.gold += 10; return "<span class='gold-text'>ğŸ’° ã‚´ãƒ¼ãƒ«ãƒ‰ +10</span>"; }}
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            const item = items[Math.floor(Math.random() * items.length)];
            
            player.inventory.push(item.name);
            const effectText = item.effect();
            
            const location = gameData.locations[player.currentLocation];
            
            showMessage(`
                <strong>ğŸ” æ¢ç´¢çµæœ</strong><br><br>
                ${event}<br><br>
                æ‰‹ã«å…¥ã‚ŒãŸ: <strong>${item.name}</strong><br>
                ${effectText}<br><br>
                <small>å‘¨å›²ã®æƒ…å ±:<br>
                NPC: ${location.npcs.join(', ')}<br>
                å±é™º: ${location.enemies.join(', ')}<br>
                è¡Œã‘ã‚‹å ´æ‰€: ${location.connected.join(', ')}</small>
            `);
            
            checkLevelUp();
            updateStatus();
        }

        // å‹‰å¼·
        function study() {
            if (player.inBattle) return;
            
            const vocabList = gameData.vocabulary.easy;
            const selected = [];
            while (selected.length < 3) {
                const word = vocabList[Math.floor(Math.random() * vocabList.length)];
                if (!selected.includes(word)) selected.push(word);
            }
            
            let html = '<strong>ğŸ“š è¨€èªå­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³</strong><br><br>';
            
            selected.forEach(word => {
                html += `
                    <div class="word-card">
                        <div class="jp">ğŸ‡¯ğŸ‡µ ${word.jp}</div>
                        <div class="en">ğŸ‡¬ğŸ‡§ ${word.en}</div>
                        <div class="cn">ğŸ‡¨ğŸ‡³ ${word.cn}</div>
                        <small>ãƒ†ãƒ¼ãƒ: ${word.theme}</small>
                    </div>
                `;
            });
            
            const expGain = Math.floor(Math.random() * 10) + 5;
            player.englishExp += expGain;
            player.chineseExp += expGain;
            player.exp += expGain;
            
            html += `<br>âœ¨ <span class="exp">è‹±èªçµŒé¨“å€¤ +${expGain} / ä¸­å›½èªçµŒé¨“å€¤ +${expGain}</span>`;
            
            showMessage(html);
            checkLevelUp();
            updateStatus();
        }

        // ãƒãƒˆãƒ«
        function battle() {
            if (player.inBattle) return;
            
            const location = gameData.locations[player.currentLocation];
            if (location.enemies.length === 0) {
                showMessage('ã“ã®å ´æ‰€ã«ã¯æ•µãŒã„ãªã„ã‚ˆã†ã ...');
                return;
            }
            
            const enemyName = location.enemies[Math.floor(Math.random() * location.enemies.length)];
            const enemy = gameData.battles[enemyName];
            
            player.inBattle = true;
            player.currentEnemy = { name: enemyName, hp: enemy.hp, maxHp: enemy.hp };
            
            const question = enemy.questions[Math.floor(Math.random() * enemy.questions.length)];
            
            showMessage(`
                <div class="battle-enemy">
                    <h3>âš”ï¸ ${enemyName} ãŒç¾ã‚ŒãŸï¼</h3>
                    <div>â¤ï¸ HP: ${enemy.hp}/${enemy.hp}</div>
                </div>
                <div class="question-box">
                    <h4>â“ ${question.q}</h4>
                    <div>ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ${question.hint}</div>
                    <div class="input-group">
                        <input type="text" id="battleAnswer" placeholder="ç­”ãˆã‚’å…¥åŠ›" onkeypress="if(event.key==='Enter')submitBattle()">
                        <button onclick="submitBattle()">æ”»æ’ƒï¼</button>
                    </div>
                </div>
            `);
            
            player.currentQuestion = question;
        }

        // ãƒãƒˆãƒ«å›ç­”
        function submitBattle() {
            const answer = document.getElementById('battleAnswer').value.trim().toLowerCase();
            const question = player.currentQuestion;
            
            if (question.a.includes(answer)) {
                // æ­£è§£
                const damage = Math.floor(Math.random() * 15) + 15;
                const expGain = Math.floor(Math.random() * 10) + 10;
                const goldGain = Math.floor(Math.random() * 10) + 5;
                
                player.exp += expGain;
                player.gold += goldGain;
                
                if (question.type === 'english') {
                    player.englishExp += 10;
                } else {
                    player.chineseExp += 10;
                }
                
                showMessage(`
                    âœ… <strong>æ­£è§£ï¼</strong><br><br>
                    ğŸ—¡ï¸ <span class="damage">${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸</span>ä¸ãˆãŸï¼<br>
                    â­ <span class="exp">çµŒé¨“å€¤ +${expGain}</span><br>
                    ğŸ’° <span class="gold-text">ã‚´ãƒ¼ãƒ«ãƒ‰ +${goldGain}</span><br><br>
                    ${player.currentEnemy.name}ã‚’å€’ã—ãŸï¼
                `);
                
                player.inBattle = false;
                player.currentEnemy = null;
            } else {
                // ä¸æ­£è§£
                const damage = Math.floor(Math.random() * 10) + 5;
                player.hp -= damage;
                
                showMessage(`
                    âŒ <strong>ä¸æ­£è§£...</strong><br>
                    æ­£è§£ã¯ã€Œ<strong>${question.a[0]}</strong>ã€ã ã£ãŸ<br><br>
                    ğŸ’” <span class="damage">${damage}ãƒ€ãƒ¡ãƒ¼ã‚¸</span>å—ã‘ãŸï¼<br>
                    æ®‹ã‚ŠHP: ${player.hp}/${player.maxHp}
                `);
                
                if (player.hp <= 0) {
                    showMessage('<br>ğŸ’€ <strong>ã‚ãªãŸã¯å€’ã‚ŒãŸ...</strong><br>æ‘ã«æˆ»ã‚Šã€HPãŒå›å¾©ã—ã¾ã—ãŸã€‚');
                    player.hp = player.maxHp;
                    player.currentLocation = 'å§‹ã¾ã‚Šã®æ‘';
                    player.inBattle = false;
                    player.gold = Math.floor(player.gold / 2);
                }
            }
            
            checkLevelUp();
            updateStatus();
        }

        // ç§»å‹•
        function move() {
            if (player.inBattle) return;
            
            const location = gameData.locations[player.currentLocation];
            const destinations = location.connected;
            
            let html = '<strong>ğŸš¶ ã©ã“ã«ç§»å‹•ã™ã‚‹ï¼Ÿ</strong><br><br>';
            
            destinations.forEach(dest => {
                const destData = gameData.locations[dest];
                html += `
                    <button onclick="moveTo('${dest}')" style="margin: 5px;">
                        ${dest}<br>
                        <small>ğŸ‡¬ğŸ‡§ ${destData.name_en} | ğŸ‡¨ğŸ‡³ ${destData.name_cn}</small>
                    </button>
                `;
            });
            
            showMessage(html);
        }

        function moveTo(destination) {
            player.currentLocation = destination;
            const loc = gameData.locations[destination];
            
            showMessage(`
                <strong>ğŸš¶ ${destination}ã«åˆ°ç€ï¼</strong><br><br>
                ğŸ‡¬ğŸ‡§ ${loc.name_en}<br>
                ğŸ‡¨ğŸ‡³ ${loc.name_cn}<br><br>
                ${loc.description}<br><br>
                <small>ã“ã“ã«ã„ã‚‹NPC: ${loc.npcs.join(', ')}<br>
                æ³¨æ„ã™ã¹ãæ•µ: ${loc.enemies.join(', ')}</small>
            `);
            
            updateStatus();
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus() {
            if (player.inBattle) return;
            
            showMessage(`
                <strong>ğŸ“Š ${player.name} ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</strong><br><br>
                â¤ï¸ HP: ${player.hp}/${player.maxHp}<br>
                â­ Level: ${player.level}<br>
                ğŸ“ˆ çµŒé¨“å€¤: ${player.exp}/${player.level * 50}<br>
                ğŸ’° Gold: ${player.gold}<br>
                ğŸ“ ç¾åœ¨åœ°: ${player.currentLocation}<br><br>
                ğŸ‡¬ğŸ‡§ è‹±èªçµŒé¨“å€¤: ${player.englishExp}<br>
                ğŸ‡¨ğŸ‡³ ä¸­å›½èªçµŒé¨“å€¤: ${player.chineseExp}<br><br>
                ğŸ’ æŒã¡ç‰©:<br>
                ${player.inventory.length > 0 ? player.inventory.map(i => '- ' + i).join('<br>') : '- (ãªã—)'}
            `);
        }

        // å˜èªå¸³
        function showVocab() {
            if (player.inBattle) return;
            
            let html = '<strong>ğŸ“– å˜èªå¸³</strong><br><br>';
            
            ['easy', 'medium'].forEach(level => {
                html += `<strong>ã€${level === 'easy' ? 'åˆç´š' : 'ä¸­ç´š'}ã€‘</strong><br>`;
                gameData.vocabulary[level].slice(0, 5).forEach(word => {
                    html += `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                            ğŸ‡¯ğŸ‡µ ${word.jp} | ğŸ‡¬ğŸ‡§ ${word.en} | ğŸ‡¨ğŸ‡³ ${word.cn}
                        </div>
                    `;
                });
                html += '<br>';
            });
            
            showMessage(html);
        }

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
        function checkLevelUp() {
            const required = player.level * 50;
            if (player.exp >= required) {
                player.level++;
                player.maxHp += 20;
                player.hp = player.maxHp;
                showMessage(`<br>ğŸ‰ <strong>LEVEL UP!</strong> Lv.${player.level}ã«ãªã£ãŸï¼<br>â¤ï¸ æœ€å¤§HPãŒ${player.maxHp}ã«ãªã£ãŸï¼`);
            }
        }
    </script>
</body>
</html>
